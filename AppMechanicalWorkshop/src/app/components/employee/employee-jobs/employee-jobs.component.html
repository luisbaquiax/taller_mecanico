<div class="p-6">

  <!-- Header -->
  <div class="flex justify-between items-center mb-6">
    <div>
      <h2 class="text-2xl font-bold text-gray-800">Mis Trabajos Asignados</h2>
      <p class="text-gray-600">Gestiona tus trabajos actuales y completados</p>
    </div>
    <button
      mat-raised-button
      color="primary"
      (click)="refreshJobs()"
      [disabled]="isLoading()"
    >
      <mat-icon class="mr-2">refresh</mat-icon>
      Actualizar
    </button>
  </div>

  <!-- Resumen de estadísticas -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
    <mat-card class="bg-blue-50 border-l-4 border-blue-500">
      <mat-card-content class="p-4">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm font-medium text-blue-600">Activos</p>
            <p class="text-2xl font-bold text-blue-800">{{ trabajosActivos }}</p>
          </div>
          <mat-icon class="text-blue-500 text-3xl">work</mat-icon>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="bg-orange-50 border-l-4 border-orange-500">
      <mat-card-content class="p-4">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm font-medium text-orange-600">Pendientes</p>
            <p class="text-2xl font-bold text-orange-800">{{ trabajosPendientes }}</p>
          </div>
          <mat-icon class="text-orange-500 text-3xl">pending</mat-icon>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="bg-green-50 border-l-4 border-green-500">
      <mat-card-content class="p-4">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm font-medium text-green-600">Completados</p>
            <p class="text-2xl font-bold text-green-800">{{ trabajosCompletados }}</p>
          </div>
          <mat-icon class="text-green-500 text-3xl">check_circle</mat-icon>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading()" class="flex justify-center items-center py-12">
    <mat-progress-spinner mode="indeterminate" diameter="60"></mat-progress-spinner>
  </div>

  <!-- Error State -->
  <div *ngIf="error()" class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
    <div class="flex items-center">
      <mat-icon class="mr-2">error</mat-icon>
      <span>{{ error() }}</span>
    </div>
    <button mat-raised-button color="primary" (click)="refreshJobs()" class="mt-2">
      Reintentar
    </button>
  </div>

  <!-- Lista de Trabajos -->
  <div *ngIf="!isLoading() && !error()" class="grid grid-cols-1 lg:grid-cols-2 gap-6">
    <mat-card
      *ngFor="let job of jobs()"
      class="hover:shadow-lg transition-shadow duration-200 cursor-pointer"
      (click)="verDetalles(job)"
    >
      <mat-card-header class="pb-2">
        <div class="flex justify-between items-center w-full">
          <div>
            <mat-card-title class="text-lg">
              {{ job.placaVehiculo }} - {{ job.marcaVehiculo }} {{ job.modeloVehiculo }}
            </mat-card-title>
            <mat-card-subtitle>
              Cliente: {{ job.clienteNombre }}
            </mat-card-subtitle>
          </div>
          <mat-chip-set>
            <mat-chip [color]="getEstadoColor(job.estadoTrabajo)" selected>
              <mat-icon matChipAvatar>{{ getEstadoIcon(job.estadoTrabajo) }}</mat-icon>
              {{ job.estadoTrabajo }}
            </mat-chip>
          </mat-chip-set>
        </div>
      </mat-card-header>

      <mat-card-content class="pb-2">
        <div class="space-y-2">
          <div class="flex items-center">
            <mat-icon class="text-gray-500 mr-2 text-sm">build</mat-icon>
            <span class="text-sm">{{ job.tipoMantenimiento }}</span>
          </div>

          <div class="flex items-center">
            <mat-icon class="text-gray-500 mr-2 text-sm">schedule</mat-icon>
            <span class="text-sm">{{ job.horasEstimadas || 0 }} horas estimadas</span>
          </div>

          <div class="flex items-center">
            <mat-icon class="text-gray-500 mr-2 text-sm">today</mat-icon>
            <span class="text-sm">Asignado: {{ job.fechaAsignacion | date:'short' }}</span>
          </div>

          <p class="text-gray-700 text-sm mt-2 line-clamp-2">
            {{ job.descripcion }}
          </p>
        </div>
      </mat-card-content>

      <mat-card-actions class="flex justify-between items-center pt-2">
        <div class="flex space-x-2">
          <button
            mat-raised-button
            color="primary"
            size="small"
            (click)="verDetalles(job); $event.stopPropagation()"
          >
            <mat-icon class="mr-1">visibility</mat-icon>
            Ver Detalles
          </button>
        </div>

        <div class="flex space-x-2">
          <button
            *ngIf="job.estadoTrabajo === 'ASIGNADO' || job.estadoTrabajo === 'PENDIENTE'"
            mat-raised-button
            color="accent"
            size="small"
            (click)="iniciarTrabajo(job); $event.stopPropagation()"
          >
            <mat-icon class="mr-1">play_arrow</mat-icon>
            Iniciar
          </button>

          <button
            *ngIf="job.estadoTrabajo === 'EN_CURSO'"
            mat-raised-button
            color="primary"
            size="small"
            (click)="finalizarTrabajo(job); $event.stopPropagation()"
          >
            <mat-icon class="mr-1">check</mat-icon>
            Finalizar
          </button>
        </div>
      </mat-card-actions>
    </mat-card>
  </div>

  <!-- Empty State -->
  <div *ngIf="!isLoading() && !error() && jobs().length === 0" class="text-center py-12">
    <mat-icon class="text-gray-400 text-6xl mb-4">assignment</mat-icon>
    <h3 class="text-xl font-medium text-gray-700 mb-2">No tienes trabajos asignados</h3>
    <p class="text-gray-500">Los nuevos trabajos aparecerán aquí cuando sean asignados por el administrador.</p>
  </div>

</div>
