<div class="p-4">
  @if (showJobView) {
    <button
        matIconButton
        class="!rounded p-4 m-4 text-dark"
        (click)="closeShwoView()"
        title="Volver"
      >
        <mat-icon>keyboard_double_arrow_up</mat-icon>
      </button>
    <h1 class="text-2xl font-bold text-center bg">Detalle de Trabajo</h1>
      <mat-divider></mat-divider>
    <mat-list>
  <div mat-subheader>Empleados asignados</div>
  @for (element of assigments; track $index) {
    <div class="flex flex-col">
      <mat-list-item>
      <mat-icon matListItemIcon>assignment_ind</mat-icon>
      <div matListItemTitle>{{searchUser(element.userId).name}} {{searchUser(element.userId).lastName}} </div>
      <div matListItemLine>{{element.roleAssignment}}</div>
    </mat-list-item>
    </div>
  }
  <div mat-subheader>Servicios aplicados</div>
  @for (element of jobServices; track $index) {
    <div class="flex flex-col">
      <mat-list-item>
      <mat-icon matListItemIcon>construction</mat-icon>
      <div matListItemTitle>Nombre: {{ searchService(element.serviceTypeId).nameServiceType }} </div>
      <div matListItemTitle>Descripción: {{ searchService(element.serviceTypeId).descriptionServiceType }} </div>
      <div matListItemLine>Precio: Q. {{element.price}}</div>
    </mat-list-item>
    </div>
  }
  <mat-divider></mat-divider>
  <mat-divider></mat-divider>
  <div mat-subheader>Repuestos usados</div>
  @for (element of jobParts; track $index) {
    <div class="flex flex-col">
      <mat-list-item>
      <mat-icon matListItemIcon>extension</mat-icon>
      <div matListItemTitle>Nombre del repuesto: {{ searchPart(element.partId).namePart }} </div>
      <div matListItemTitle>Marca del repuesto: {{ searchPart(element.partId).brandPart }} </div>
      <div matListItemTitle>Descripción del repuesto: {{ searchPart(element.partId).descriptionPart }} </div>
      <div matListItemLine>Precio: Q.{{ searchPart(element.partId).salePrice }}</div>
    </mat-list-item>
    </div>
  }
  <mat-divider></mat-divider>

</mat-list>
  } @else {
  <h2 class="text-2xl font-bold text-center bg">Lista de Trabajos</h2>
  <form [formGroup]="registerForm" (ngSubmit)="onSubmit()">
    <div class="flex flex-row gap-6 mt-4">
      <button
        matIconButton
        class="w-full mt-4 !rounded-none"
        (click)="setDataSource()"
        title="Ver todos los trabajos"
        type="button"
      >
        <mat-icon>format_list_numbered</mat-icon>
      </button>
      <!-- estados de trabajo -->
      <mat-form-field floatLabel="always" class="w-full mb-4">
        <mat-label>Filtrar por estado</mat-label>
        <mat-select formControlName="statusJob">
          @for (element of statusJobs; track $index) {
          <mat-option [value]="element.statusJobId">
            {{ element.nameStatusJob }}
          </mat-option>
          }
        </mat-select>
        @if (registerForm.get('statusJob')?.hasError('required')) {
        <mat-error>El estado de trabajo debe ser seleccionado</mat-error>
        }
      </mat-form-field>

      <!-- Botón buscar -->
      <button matIconButton class="w-full mt-4 !rounded-none" type="submit">
        <mat-icon>search</mat-icon>
      </button>
    </div>
  </form>

  <table mat-table [dataSource]="dataSource" class="mat-elevation-z8 demo-table">
    <!-- ID Column -->
    <ng-container matColumnDef="jobId">
      <th mat-header-cell *matHeaderCellDef>ID</th>
      <td mat-cell *matCellDef="let element">{{ element.jobId }}</td>
    </ng-container>

    <!-- Created By Column -->
    <ng-container matColumnDef="createdBy">
      <th mat-header-cell *matHeaderCellDef>Creado Por</th>
      <td mat-cell *matCellDef="let element">{{ username }}</td>
    </ng-container>

    <!-- Vehicle ID Column -->
    <ng-container matColumnDef="vehicleId">
      <th mat-header-cell *matHeaderCellDef>ID Vehículo/Placa</th>
      <td mat-cell *matCellDef="let element">
        <div class="flex flex-col">
          <span class="text-center">{{ element.vehicleId }}</span>
          <mat-hint align="end" class="text-center">{{
            getLicencePlate(element.vehicleId)
          }}</mat-hint>
        </div>
      </td>
    </ng-container>

    <!-- Started At Column
    <ng-container matColumnDef="startedAt">
      <th mat-header-cell *matHeaderCellDef>Fecha de Inicio</th>
      <td mat-cell *matCellDef="let element">{{ element.startedAt | date:'dd/MM/yyyy HH:mm' }}</td>
    </ng-container>

    <ng-container matColumnDef="finishedAt">
      <th mat-header-cell *matHeaderCellDef>Fecha de Fin</th>
      <td mat-cell *matCellDef="let element">{{ element.finishedAt | date:'dd/MM/yyyy HH:mm' }}</td>
    </ng-container>
    -->

    <!-- Type Job ID Column -->
    <ng-container matColumnDef="typeJobId">
      <th mat-header-cell *matHeaderCellDef>Tipo de Trabajo</th>
      <td mat-cell *matCellDef="let element">{{ getJobTypeName(element.typeJobId) }}</td>
    </ng-container>

    <!-- Status Job ID Column -->
    <ng-container matColumnDef="statusJobId">
      <th mat-header-cell *matHeaderCellDef>Estado</th>
      <td mat-cell *matCellDef="let element">{{ getJobStatusName(element.statusJobId) }}</td>
    </ng-container>

    <!-- Description Column -->
    <ng-container matColumnDef="description">
      <th mat-header-cell *matHeaderCellDef>Descripción</th>
      <td mat-cell *matCellDef="let element">{{ element.description }}</td>
    </ng-container>

    <!-- Estimated Hours Column -->
    <ng-container matColumnDef="estimatedHours">
      <th mat-header-cell *matHeaderCellDef>Horas Estimadas</th>
      <td mat-cell *matCellDef="let element">{{ element.estimatedHours }}h</td>
    </ng-container>

    <!-- Actions Column -->
    <ng-container matColumnDef="actions">
      <th mat-header-cell *matHeaderCellDef>Acciones</th>
      <td mat-cell *matCellDef="let element">
        <button mat-icon-button [matMenuTriggerFor]="menuUsers">
          <mat-icon>more_vert</mat-icon>
        </button>

        <!-- Definición del menú -->
        <mat-menu #menuUsers="matMenu">
          <button mat-menu-item (click)="viewJob(element)"><mat-icon>visibility</mat-icon>Ver detalle</button>
          <button mat-menu-item (click)="cancelJob(element)"><mat-icon>cancel</mat-icon>Cancelar</button>
        </mat-menu>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
  </table>
  }

</div>
